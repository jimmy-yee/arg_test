<!doctype html>
<html>
    <head>
        <link rel="stylesheet", href="./ar.css",type='text/css'>
        <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
        <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>
        <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-handler.js"></script>
        <script src="ar.js"></script>
    </head>

    <body style="margin: 0; overflow: hidden;">
        <button id="back" onclick="location.href='./2d.html'">back</button>
        <button id="my_button">get a picture</button>
       
        <div id="ar_mode">
            <a-scene
                vr-mode-ui="enabled: false;"
                loading-screen="enabled: false;"
                arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
                id="scene"
                embedded
                gesture-detector
            >
                <a-marker
                    id="animated-marker"
                    type="pattern"
                    preset="custom"
                    url="assets/marker.patt"
                    raycaster="objects: .clickable"
                    emitevents="true"
                    cursor="fuse: false; rayOrigin: mouse;"
                    id="markerA"
                >
                    <a-image
                        src="assets/asset.jpeg"
                        scale="1 1 1"
                        class="clickable"
                        rotation="-90 0 0"
                        gesture-handler
                    ></a-image>
                    <a-entity
                        text="width: 5; value: You find it"
                        scale="1 1 1"
                        class="clickable"
                        rotation="-90 0 0" 
                        position='1.4 1.8 0'>
                    </a-entity>
                    <!-- <a-entity id="refresh-button" geometry="primitive: box" material="color: red" position="1.4 2 0">
                    </a-scene> -->
                    <!-- <a-text
                        value="哭哭">
                    </a-text> -->
                </a-marker>
                <a-marker
                    id="animated-marker"
                    type="pattern"
                    preset="custom"
                    url="assets/pattern-flag@3x.patt"
                    raycaster="objects: .clickable"
                    emitevents="true"
                    cursor="fuse: false; rayOrigin: mouse;"
                    id="markerA"
                >
                    <a-image
                    src="assets/flag2@3x.png"
                    scale="0.5 0.5 0.5"
                    class="clickable"
                    rotation="-90 0 0"
                    gesture-handler
                    ></a-image>   
                </a-marker>
                <a-marker
                    id="animated-marker"
                    type="pattern"
                    preset="custom"
                    url="assets/pattern-tiger.patt"
                    raycaster="objects: .clickable"
                    emitevents="true"
                    cursor="fuse: false; rayOrigin: mouse;"
                    id="markerA"
                >
                    <a-image
                    src="assets/黃斑部病變濾鏡.png"
                    scale="0.5 0.25 0.5"
                    class="clickable"
                    rotation="-90 0 0"
                    gesture-handler
                    ></a-image>   
                </a-marker>
                <a-entity camera></a-entity>
            </a-scene>
        </div>
        <canvas width='640' height='480' style='visibility:hidden;' id='doubleImage'></canvas>
        <script>
            var imagebottom = document.querySelector('#my_button')
            function takeScreenshot() {
			var w = window.open('', '');
			w.document.title = "Screenshot";
			var img = new Image();
			var secondImg = new Image();
			renderer.render(scene, camera);
			var doubleImageCanvas = document.getElementById('doubleImage');
			var context = doubleImageCanvas.getContext('2d');
			var sources = {
				firstImage: renderer.domElement.toDataURL("image/png"),
				secondImage: arToolkitContext.arController.canvas.toDataURL("image/png")
			};

			loadImages(sources, function(images){
				context.drawImage(images.secondImage, 0, 0);
				context.drawImage(images.firstImage, 0, 0);
				img.src = doubleImageCanvas.toDataURL("image/png");
				w.document.body.appendChild(img);
			});
		}

		function loadImages(sources, callback) {
			var images = {};
			var loadedImages = 0;
			var numImages = 0;
			// get num of sources
			for (var src in sources) {
				numImages++;
			}
			for (var src in sources) {
				images[src] = new Image();
				images[src].onload = function () {
					if (++loadedImages >= numImages) {
						callback(images);
					}
				};
				images[src].src = sources[src];
			}
		}

        imagebottom.addEventListener('click', takeScreenshot)
        </script>
    </body>
</html>
